---
title: "London's cultural venues"
author: "Dipankar Lahiri"
date: "2025-03-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(dplyr)
library(treemap)
library(ggplot2)
library(sf)
library(tmap)
library(leaflet)
library(leaflet.extras)
library(osmdata)
library(geojsonsf)

df <- read_csv ('/Users/dipankarlahiri/Desktop/College/Sem 2/Data Analysis and Collection/R/Projects/Training/Spatial analysis/Data/london_cultural_venues_all_sites.csv')

df$runtime <- as.Date(df$runtime, format = "%m/%d/%Y")
df <- df %>% select(-c(alternativenames, building_name, greenflagcommunityaward, borough_name))
df$ward_2018_code_merged <- ifelse(!is.na(df$ward_2018_code), df$ward_2018_code, df$ward_code_2018)
df$ward_2018_name_merged <- ifelse(!is.na(df$ward_2018_name), df$ward_2018_name, df$ward_name_2018)
df$gss_code_merged <- ifelse(is.na(df$gss_code), df$borough_code, df$gss_code)
df <- df[, !(names(df) %in% c("ward_2018_code", "ward_code_2018", "ward_2018_name", "ward_name_2018"))]
df <- df[, !(names(df) %in% c("gss_code", "borough_code"))]

```

# This is an analysis of data on cultural venues in London released by the Greater London Authority. The raw dataset categorizes London's 10,003 cultural venues by 29 variables.

# Description of dataset: Of the 29 variables, some have very high number of NAs. All three logical variables have all values as NA, suggesting a data loading issue. Dropped all three columns alternativenames, building_name, greenflagcommunityaward. Changed the class of the runtime column from character to date. Another data cleaning issue seems to be because of column duplication: ward_2018_code (chr) has 186 NAs, ward_code_2018 (chr) has 9919 NAs, ward_2018_name (chr) has 186 NAs, ward_name_2018 (chr) has 9919 NAs. For rows where ward_2018_code is not NA, ward_code_2018 is always NA. For rows where ward_2018_code is NA, ward_code_2018 is non-NA in 84 cases (and NA in 102 cases). This systematic pattern suggests that these columns are alternative representations of the same underlying information, coming from different data sources, instead of being random missing values. The four columns for ward names and codes from 2018 were thus merged into two. A same process was done with borough_code and gss_code. The dataset now has 22 columns.

```{r}
unique(df$BOROUGH)
unique(df$`Cultural Venue Type`)

```

# All 33 London boroughs are represented in the dataset - Tower Hamlets, Camden, Ealing, Hammersmith and Fulham, City of London, Newham, Merton, Wandsworth, Barnet, Brent, Enfield, Kensington and Chelsea, Islington, Sutton, Southwark, Haringey, Hackney, Lambeth, Greenwich, Hillingdon, Lewisham, Westminster, Harrow, Hounslow, Richmond upon Thames, Bexley, Waltham Forest, Redbridge, Croydon, Barking and Dagenham, Kingston upon Thames, Bromley, Havering.

# The 10,003 venues have 33 categories - Archives, Artists workspaces, Arts centres, Cinemas, Commercial galleries, Community centres, Creative co-working desk space, Creative workspaces, Dance performance venues, Dance rehearsal studios, Fashion and design, Jewellery design, Large media production studios, Legal street art walls, LGBT+ night time venues, Libraries, Live in artists' workspace, Makerspaces, Making and manufacturing, Museums and public galleries, Music (office based businesses), Music recording studios, Music rehearsal studios, Music venues (all), Music venues (grassroots), Outdoor spaces for cultural use, Prop and costume making, Pubs, Set and exhibition building, Skate Parks, Textile design, Theatre rehearsal studio, Theatres.

# VENUE TYPES

```{r}

category_counts <- df %>% count(`Cultural Venue Type`, name = "venue_count") %>% arrange(desc(venue_count))
print(category_counts)

treemap(category_counts,
        index = "Cultural Venue Type",
        vSize = "venue_count",
        title = "Distribution of Cultural Venue Types in London",
        palette = "Blues")
```

# Pubs (4098) are the most represented venue type. This is followed by Community centres (903), Music venues (797) and Archives (556). Of the 33 venue types, Large media production studios (5) is the least represented.

# VENUES PER BOROUGH

```{r}

borough_counts <- df %>% count(BOROUGH, name = "venue_count") %>% arrange(desc(venue_count))
print(borough_counts)

ggplot(borough_counts, aes(x = reorder(BOROUGH, venue_count), y = venue_count)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Number of Cultural Venues per Borough", x = "Borough", y = "Venue Count")

```

# Westminster (1186) has the most cultural venues among the 33 London boroughs. Following closely are Camden (892) and Hackney (683). The boroughs with the least cultural venues are Barking and Dagenham (85), Redbridge (101) and Sutton (103).

# VENUE MAPPING

```{r}

ggplot(df, aes(x = longitude, y = latitude)) +
  geom_point(alpha = 0.5, color = "red") +
  coord_fixed() +
  labs(title = "Geospatial Distribution of Cultural Venues in London")

ggplot(df, aes(x = longitude, y = latitude)) +
  geom_point(alpha = 0.5, color = "red") +
  facet_wrap(~ BOROUGH) +
  labs(title = "Cultural Venues in London by Borough")

```

# INTERACTIVE MAP

```{r}

leaflet(df) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~longitude, lat = ~latitude, popup = ~site_name, 
                   color = "red", fillOpacity = 0.5, radius = 3)

```

# VENUE DISTRIBUTION PER BOROUGH

```{r}

shapefile_path <- "/Users/dipankarlahiri/Desktop/College/Sem 2/Data Analysis and Collection/R/Projects/Training/Spatial analysis/Data/statistical-gis-boundaries-london/ESRI/London_Borough_Excluding_MHW.shp"
london_boroughs_sf <- st_read(shapefile_path)
london_boroughs_sf <- london_boroughs_sf %>%
  rename(BOROUGH = NAME)
borough_counts_sf <- london_boroughs_sf %>%
  left_join(borough_counts, by = "BOROUGH")

tm_shape(borough_counts_sf) +
  tm_polygons("venue_count", palette = "Blues", title = "Cultural Venues per Borough")


```
# VENUE TYPES ACROSS BOROUGHS

```{r}

ggplot(df, aes(x = BOROUGH, fill = `Cultural Venue Type`)) +
  geom_bar() +
  coord_flip() +
  labs(title = "Distribution of Venue Types Across Boroughs", x = "Borough", y = "Count")

```

